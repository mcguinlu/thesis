---
#########################################
# options for knitting a single chapter #
#########################################
output:
  bookdown::html_document2: default
  bookdown::word_document2: default
  bookdown::pdf_document2:
    template: templates/brief_template.tex
documentclass: book
---

# Covering material {-}

\adjustmtc 
<!-- For PDF output, we must include this LaTeX command after unnumbered headings, otherwise the numbers in the mini table of contents will be incorrect -->

```{r word-count, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)

get_words_short <- function(){

files <- list.files(path = here::here(), pattern = "\\.Rmd$")

files <- files[which(!(files %in% c("_main.Rmd","index.Rmd")))]

words_v <- c()

for (file in 1:length(files)) {
  tmp <- wordcountaddin::word_count(here::here(files[file]))
  words_v <- c(words_v, tmp)
}

words <- sum(words_v)

return(words)

}

get_words <- function(){

files <- list.files(path = here::here(), pattern = "\\.Rmd$")

files <- files[which(!(files %in% c("_main.Rmd","index.Rmd")))]

words_v <- c()

for (file in 1:length(files)) {
  tmp <- wordcountaddin::word_count(here::here(files[file]))
  words_v <- c(words_v, tmp)
}

words <- sum(words_v)

date <- as.character(format(Sys.time(),"%Y%m%d"))
time <- as.character(format(Sys.time(),"%H%M"))

tmpWords <- data.frame(words = words,
                       date = date,
                       time = time)

masterWords <- read.csv(here::here("data","words","words.csv"),
                        header = TRUE)

masterWords <- rbind(masterWords,
                     tmpWords) %>%
  dplyr::group_by(date) %>%
  slice(which.max(time)) %>%
  dplyr::ungroup()

return(masterWords)

}

words <- get_words()

write.csv(file = here::here("data","words","words.csv"),
          x = words,
          col.names = FALSE,
          row.names = FALSE)



start_date <- as.Date("20201124", format="%Y%m%d")

max_date <- as.Date(max(words$date), format="%Y%m%d")

words_today <- words$words[which(as.Date(words$date, format="%Y%m%d")==max_date)]

date_diff <- as.numeric((max_date) - start_date)

target <- (date_diff*200)+5580-17000

words_behind <- words$words[which(words$date == max(words$date))] - target

words_new_today <- words$words[which(words$date == max(words$date))] - words$words[length(words$words)-1]

target_df <- data.frame(date = c(start_date,max_date),
                           words = c(5580, target))

words$date <- as.Date(words$date, format="%Y%m%d")

```

Word count: `r words_today`

Days: `r date_diff`

Words behind: `r format(words_behind, scientific = F)`

Words today: `r words_new_today`

&nbsp;  

&nbsp;  

```{r word-count-fig, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(mapping = aes(x=date,y=words)) +
  geom_line(data = target_df, colour = "blue") +
  geom_step(data = words, colour = "red")

```