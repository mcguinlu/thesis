---
output:
  pdf_document: default
  html_document: default
---
`r if(knitr:::is_latex_output()) '\\startappendices'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'`

<!-- If you feel it necessary to include an appendix, it goes here. The first appendix should include the commands above. -->

```{r, echo = FALSE, warning=FALSE, message=FALSE}
source(here::here("R/helper.R"))
knitr::read_chunk(here::here("R/appendix.R"))
doc_type <- knitr::opts_knit$get('rmarkdown.pandoc.to') # Info on knitting format
```

<!----------------------------------------------------------------------------->
# By Chapter {#chapter-appendix-heading}

<!----------------------------------------------------------------------------->
## Chapter \@ref(background-heading) {#appendix-into}

<!----------------------------------------------------------------------------->
### Publications beyond the scope of this thesis {#appendix-publications}

__Peer reviewed__

  * PRISMA main paper
  
  * PRISMA E&E
  
  * PRISMA 2020 software
  
  * COVID Suicide Living Review
  
  * Data extraction tools systematic review
  
  
<!-- TODO update list with proper references and a description of each. Essentially, look at the Trello -->

__Under review/Preprints__

  * MSc Paper on systematic reviews of this thesis topic
  
  * 
  
  
  
<!----------------------------------------------------------------------------->

### Involvement of patients and the public {#appendix-ppi}

Patients were involved at several stages of this research. when designing the PhD programme of work, a Patient and Public Advisory Group (PPAG) provided feedback on the relevance of the question.

Additionally,

Lay summaries appear at the beginning of each chapter, reviewed by the Patient and Public Involvement panel. They provide a plain language summary

<!----------------------------------------------------------------------------->

## Chapter \@ref(sys-rev-tools-heading) {#appendix-sys-rev-tools}
<!----------------------------------------------------------------------------->

### Code for publication rate analysis

```{r, eval=FALSE}
med_res <-
  # Use snapshot of published status from July 2021
  medrxivr::mx_search(
    medrxivr::mx_snapshot("ccedfb8a44304b9fba4e3ba518a8ce4ed2294770"),
    query = "*",
    from_date = "2019-07-01",
    to_date = "2019-08-01"
  ) %>%
  # Create indicator to show which records have been published
  mutate(pub_ind = ifelse(published == "NA", 0, 1)) %>%
  # Group by indicator variable and count
  group_by(pub_ind) %>%
  count() 

```


## Chapter \@ref(sys-rev-heading) {#appendix-sys-rev}
<!----------------------------------------------------------------------------->

### Search strategy {#appendix-search-strategy}

&nbsp;

<!----------------------------------------------------------------------------->
(ref:searchHits-caption) Overview of the full Medline search strategy.

(ref:searchHits-scaption) searchHits

```{r searchHits-table, message=FALSE, results="asis", echo = FALSE}
```

<!----------------------------------------------------------------------------->

&nbsp;

### Web of Science Databases Searched {#appendix-wos-databases}

&nbsp;

<!----------------------------------------------------------------------------->
(ref:wosDatabases-caption) Summary of Web of Science databases searched.

(ref:wosDatabases-scaption) Summary of Web of Science databases searched.

```{r wosDatabases-table, message=FALSE, results="asis", echo = FALSE}

```
<!----------------------------------------------------------------------------->

&nbsp;

<!----------------------------------------------------------------------------->
### Code to search preprints {#appendix-medrxivr-code}

<!-- TODO Double check this is the final code used -->

```{r, eval = FALSE}

library(medrxivr)

mx_data <- mx_api_content(to_date = "2019-09-01")

bx_data <- mx_api_content(server = "biorxiv",
                                    to_date = "2019-09-01")

topic1 <- c(mx_caps("statin"),
            mx_caps("ldl"),
            mx_caps("hdl"),
            mx_caps("TG"),
            mx_caps("triglycer"),
            paste0("\\b",mx_caps("TC"),"\\b"),
            mx_caps("ezetim"),
            mx_caps("fibrate"),
            mx_caps("bile acid"),
            mx_caps("lipoprotein"),
            mx_caps("lipid"),
            mx_caps("cholesterol"))

topic2 <- c(mx_caps("dementia"),
            mx_caps("alzheim"),
            mx_caps("MCI"),
            mx_caps("mild cognitive"))

query <- list(
  topic1,
  topic2
)

bx_results <- mx_search(bx_data, query)


mx_results <- mx_search(mx_data, query)

```

Note

### Calculating Gwet's AC1

Gwet's AC1 is defined as:

$$AC1 = \frac{observed\;agreement-chance\;agreement}{1-chance\;agreement}$$ 

In reference to a two-by-two table with cells A, B, C and D, it is calculated using the following:

\begin{equation}
  AC1 = \frac{\frac{A+D}{N}-e(\gamma)}{1-e(\gamma)}
  (\#eq:AC1-main)
\end{equation}

where $e(\gamma)$ is the chance agreement between raters, given as $2q(1-q)$, where 

\begin{equation}
  q = \frac{(A+C)+(A+B)}{2N}
  (\#eq:AC1-supp)
\end{equation}

<!----------------------------------------------------------------------------->
### MR risk of bias tool {#appendix-mr-rob}

<!----------------------------------------------------------------------------->
(ref:mrTool-caption) Tool used to assess risk of bias in Mendelian randomisation studies, adapted from that developed by Mamluk et al.[@mamluk2020]

(ref:mrTool-scaption) Mendelian randomisation risk-of-bias assessment tool

```{r mrTool-table, message=FALSE, results="asis", echo = FALSE}

mrTool_table <- read.csv(here::here("data/sys-rev/mrRobTool.csv")) %>%
  select(1:5) %>%
  rename("Bias domain" = Bias.domain)

if(doc_type == "docx") {
  knitr::kable(mrTool_table, caption = "(ref:mrTool-caption)")
} else{
  knitr::kable(
    mrTool_table,
    format = "latex",
    caption = "(ref:mrTool-caption)",
    caption.short = "(ref:mrTool-scaption)",
    longtable = TRUE,
    booktabs = TRUE
  ) %>%
    row_spec(0, bold = TRUE) %>%
    column_spec(column = 1:5, width = paste0(32/5,"em")) %>%
    row_spec(2:nrow(mrTool_table)-1, hline_after = TRUE) %>%
    kable_styling(latex_options = c("HOLD_position","repeat_header"))
}


```

<!----------------------------------------------------------------------------->
## Chapter \@ref(cprd-analysis-heading) {#appendix-cprd-analysis}
<!----------------------------------------------------------------------------->

### Amendments to protocol {#appendix-cprd-amendments}


<!----------------------------------------------------------------------------->
## Chapter \@ref(tri-heading) {#appendix-tri-analysis}
<!----------------------------------------------------------------------------->
### Calculation of average adjustment from expert elicitation

<!----------------------------------------------------------------------------->
### Code lists


## Chapter \@ref(ipd-heading) {#appendix-ipd-analysis}
<!----------------------------------------------------------------------------->
### Email and documents sent to potental collaborators {#ipd-email-collab}

<!----------------------------------------------------------------------------->
## Chapter \@ref(discussion-heading)

<!----------------------------------------------------------------------------->
### Catalogue of failures {#appendix-catalogue-failures}

Short section detailing the things I tried to do but which did not work:

Failing to properly scope the literature and correctly estimate the number of studies returned by the search


failing to realise that the initial code list used for the positive control outcome of IHD in the CPRD analysis (Chapter \@ref(cprd-heading))

<!-- TODO Include the early analysis we did here, that did not work as a result of limited scope. Could include some of the genetic work also. Will additionally need to put the relevant materials from the paper in the  -->

<!----------------------------------------------------------------------------->
# Other Appendix {#other-appendix-heading}

## Software used to create this thesis

```{r, include = FALSE}
knitr::write_bib(c(.packages(), "bookdown", "knitr"), here::here("bibliography/packages.bib"))
```

<!-- TODO These citations are not rendering properly - I think because bookdown using this latex format only allows 1 .bib file. -->

This thesis was written in RMarkdown. Several R packages were used as part of this project.`r gen_rmd_citation("packages.bib")`
All projects in these thesis attempt to conform to minimal best practices for research computing. [@wilson2014; @wilson2017]

<!----------------------------------------------------------------------------->
## Producing risk-of-bias visualisations with `robvis` {#appendix-robvis}



\newpage

## Copies of papers arising from this thesis {#published-papers}

The following pages contain copies of papers arising from work performed as part of this thesis.

<!-- TODO May need to reiterate contributions here -->

\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/cprd_medrxiv.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/medrxivr.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/robvis.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/DAS_comparison.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/prevsci.pdf}