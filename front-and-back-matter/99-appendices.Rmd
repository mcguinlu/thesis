`r if(knitr:::is_latex_output()) '\\startappendices'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'`

```{r, echo = FALSE, warning=FALSE, message=FALSE}
source(here::here("R/helper.R"))
knitr::read_chunk(here::here("R/appendix.R"))
doc_type <- knitr::opts_knit$get('rmarkdown.pandoc.to') # Info on knitting format
```


# Appendices by Chapter {#chapter-appendix-heading}

\minitoc <!-- this will include a mini table of contents-->

\newpage

## Chapter \@ref(background-heading) {#appendix-into}

### Publications beyond the scope of this thesis {#appendix-publications}

__Peer reviewed__

  * PRISMA main paper
  
  * PRISMA E&E
  
  * PRISMA 2020 software
  
  * COVID Suicide Living Review
  
  * Data extraction tools systematic review
  
  
<!-- TODO update list with proper references and a description of each. Essentially, look at the Trello -->

__Under review/Preprints__

  * MSc Paper on systematic reviews of this thesis topic
  
  * 
  
  
  


### Involvement of patients and the public {#appendix-ppi}

Patients were involved at several stages of this research. when designing the PhD programme of work, a Patient and Public Advisory Group (PPAG) provided feedback on the relevance of the question.

Additionally,

Lay summaries appear at the beginning of each chapter, reviewed by the Patient and Public Involvement panel. They provide a plain language summary



## Chapter \@ref(sys-rev-tools-heading) {#appendix-sys-rev-tools}


### Code for publication rate analysis

```{r, eval=FALSE}
med_res <-
  # Use snapshot of published status from July 2021
  medrxivr::mx_search(
    medrxivr::mx_snapshot("ccedfb8a44304b9fba4e3ba518a8ce4ed2294770"),
    query = "*",
    from_date = "2019-07-01",
    to_date = "2019-08-01"
  ) %>%
  # Create indicator to show which records have been published
  mutate(pub_ind = ifelse(published == "NA", 0, 1)) %>%
  # Group by indicator variable and count
  group_by(pub_ind) %>%
  count() 

```


## Chapter \@ref(sys-rev-methods-heading) {#appendix-sys-rev}


### Deviations from protocol

<!-- TODO Complete -->


* MR tool, actually used Mamluk

* ROB-ME

* No MCI, given size of dementia findings
 
* Sources of funding: Given that any bias introduced by sources of funding would operate , conflicts of interest and bias were considered separate things here.[@sterne2013]
 
 * Dose response

### Web of Science Databases Searched {#appendix-wos-databases}

(ref:wosDatabases-caption) Summary of Web of Science databases searched.

(ref:wosDatabases-scaption) Summary of Web of Science databases searched.

```{r wosDatabases-table, message=FALSE, results="asis", echo = FALSE}
```

&nbsp;<!----------------------------------------------------------------------->  

### Search strategy {#appendix-search-strategy}

(ref:searchHits-caption) Overview of the full Medline search strategy.

(ref:searchHits-scaption) searchHits

```{r searchHits-table, message=FALSE, results="asis", echo = FALSE}
```

&nbsp;<!----------------------------------------------------------------------->  

### Code to search preprints {#appendix-medrxivr-code}

<!-- TODO Double check this is the final code used -->

```{r, eval = FALSE}

library(medrxivr)

mx_data <- mx_api_content(to_date = "2019-07-01")

bx_data <- mx_api_content(server = "biorxiv",
                                    to_date = "2019-07-01")

topic1 <- c(mx_caps("statin"),
            mx_caps("ldl"),
            mx_caps("hdl"),
            mx_caps("TG"),
            mx_caps("triglycer"),
            paste0("\\b",mx_caps("TC"),"\\b"),
            mx_caps("ezetim"),
            mx_caps("fibrate"),
            mx_caps("bile acid"),
            mx_caps("lipoprotein"),
            mx_caps("lipid"),
            mx_caps("cholesterol"))

topic2 <- c(mx_caps("dementia"),
            mx_caps("alzheim"),
            mx_caps("MCI"),
            mx_caps("mild cognitive"))

query <- list(
  topic1,
  topic2
)

bx_results <- mx_search(bx_data, query)


mx_results <- mx_search(mx_data, query)

```

Note

### Calculating Gwet's AC1 {#appendix-gwet}

Gwet's AC1 is defined as:

$$AC1 = \frac{observed\;agreement-chance\;agreement}{1-chance\;agreement}$$ 

In reference to a two-by-two table with cells A, B, C and D, it is calculated using the following:

\begin{equation}
  AC1 = \frac{\frac{A+D}{N}-e(\gamma)}{1-e(\gamma)}
  (\#eq:AC1-main)
\end{equation}

where $e(\gamma)$ is the chance agreement between raters, given as $2q(1-q)$, where 

\begin{equation}
  q = \frac{(A+C)+(A+B)}{2N}
  (\#eq:AC1-supp)
\end{equation}


### MR risk of bias tool {#appendix-mr-rob}

(ref:mrTool-caption) Tool used to assess risk of bias in Mendelian randomisation studies, adapted from that developed by Mamluk et al.[@mamluk2020]

(ref:mrTool-scaption) Mendelian randomisation risk-of-bias assessment tool

```{r mrTool-table, message=FALSE, results="asis", echo = FALSE}

mrTool_table <- read.csv(here::here("data/sys-rev/mrRobTool.csv")) %>%
  select(1:5) %>%
  rename("Bias domain" = Bias.domain)

if(doc_type == "docx") {
  knitr::kable(mrTool_table, caption = "(ref:mrTool-caption)")
} else{
  knitr::kable(
    mrTool_table,
    format = "latex",
    caption = "(ref:mrTool-caption)",
    caption.short = "(ref:mrTool-scaption)",
    longtable = TRUE,
    booktabs = TRUE
  ) %>%
    row_spec(0, bold = TRUE) %>%
    column_spec(column = 1:5, width = paste0(32/5,"em")) %>%
    row_spec(2:nrow(mrTool_table)-1, hline_after = TRUE) %>%
    kable_styling(latex_options = c("HOLD_position","repeat_header"))
}

```

## Chapter \@ref(sys-rev-results-heading)

### Dose response plots by fraction {#appendix-dr-fraction}


(ref:drDemeniaTC-cap) Dose-response meta-analysis of total cholesterol on all-cause dementia

(ref:drDemeniaTC-scap) shortcap

```{r drDemeniaTC, echo = FALSE, results="asis", fig.pos = "H", fig.cap='(ref:drDemeniaTC-cap)', out.width='100%', fig.scap='(ref:drDemeniaTC-scap)'}
knitr::include_graphics(file.path("figures/sys-rev/dr_Dementia_TC.png"))
```
  


(ref:drAdLDL-cap) Dose-response meta-analysis of low-density lipoprotein cholesterol on Alzheimer's disease

(ref:drAdLDL-scap) shortcap

```{r drAdLDL, echo = FALSE, results="asis", fig.pos = "H", fig.cap='(ref:drAdLDL-cap)', out.width='100%', fig.scap='(ref:drAdLDL-scap)'}
knitr::include_graphics(file.path("figures/sys-rev/dr_AD_LDL.png"))
```




## Chapter \@ref(cprd-analysis-heading) {#appendix-cprd-analysis}


### Amendments to protocol {#appendix-cprd-amendments}

## Chapter \@ref(ipd-heading) {#appendix-ipd-analysis}

### Email and documents sent to potental collaborators {#ipd-email-collab}



### Covariate matrix {#appendix-ipd-covariate-matrix}

### Dementia definitions across cohorts {#appendix-ipd-dementia-def}

&nbsp;<!----------------------------------------------------------------------->  

## Chapter \@ref(tri-heading) {#appendix-tri-analysis}

### Calculation of average adjustment from expert elicitation {#appendix-adjustment-values}


### Code lists


### Comparison of two scenarios of bias

(ref:fpLdlAdComparison-cap) Comparison of bias-/indirectness-adjusted meta-analyses of LDL-c/Alzheimer's disease, using two different scenarios for the relationship of levels of bias. The left forest plot shows the result where the difference in mean value between the "High" and "Moderate" bias levels is the same as between the "Moderate" and "Low" levels. In the right plot, the difference in mean value between "High" and "Moderate" is twice that between "Moderate" and "Low". 

(ref:fpLdlAdComparison-scap) Comparison of bias-/indirectness-adjusted meta-analyses under two different scenarios of prior distributions of bias.

```{r fpLdlAdComparison, echo = FALSE, results="asis", fig.pos = "H", fig.cap='(ref:fpLdlAdComparison-cap)', out.width='100%', fig.scap='(ref:fpLdlAdComparison-scap)'}
knitr::include_graphics(file.path("figures/tri/fp_paired_midlife_ldl_ad_scenarios.png"))
```

(ref:fpTgVaDComparison-cap) Comparison of bias-/indirectness-adjusted meta-analyses of triglycerides/vascular dementia, using two different scenarios for the relationship of levels of bias. The left forest plot shows the result where the difference in mean value between the "High" and "Moderate" bias levels is the same as between the "Moderate" and "Low" levels. In the right plot, the difference in mean value between "High" and "Moderate" is twice that between "Moderate" and "Low". 

(ref:fpTgVaDComparison-scap) Comparison of bias-/indirectness-adjusted meta-analyses under two different scenarios of prior distributions of bias.

```{r fpTgVaDComparison, echo = FALSE, results="asis", fig.pos = "H", fig.cap='(ref:fpTgVaDComparison-cap)', out.width='100%', fig.scap='(ref:fpTgVaDComparison-scap)'}
knitr::include_graphics(file.path("figures/tri/fp_paired_midlife_tg_vad_scenarios.png"))
```

## Chapter \@ref(discussion-heading)

### Reproducible research {#disc-repro-research}

Reproducible and science has been a key theme running through this thesis, as reflected by the development of an open source tool to help search medRxiv and bioRxiv preprint metadata. In line with this, an open source copy of the code used to produce this thesis is available on GitHub, as is the code used to perform the analysis contained within it. 

Unfortunately, given the. However, as discussed in other chapters of this thesis and elsewhere, sharing of analysis code is a useful step towards transparency when the underlying datasets are not readily available.

Commentary on the fact that the best you can do is replicate vs reproducible (due the closed nature of the data).

One is the ability to recreate the results given the same data and code, the other is the ability to recreate the results given the same code but a different dataset. IN theory it is possible to gain access the dataset given the information presented in Chapter \@(ref:cprd-analysis-heading). However, access is dependency on an ISAC application to the managing body of the CPRD. 


### Catalogue of failures {#appendix-catalogue-failures}

Short section detailing the things I tried to do but which did not work:

- Failed to properly scope the literature and correctly estimate the number of studies returned by the search

- Failed IV analysis of anti-HC drugs because of low numbers of non-statins.

- Failed to realise that the initial code list used for the positive control outcome of IHD in the CPRD analysis (Chapter \@ref(cprd-analysis-heading))

- Unsuccessful grant application with Andy

- Unsuccessful grant application with Chris Penfold

- Unsuccessful grant application with Matt

- Instrumental variable analysis of lipid regulation use using physicians prescribing preference. 

- 2 x unsuccessful conference abstracts

<!-- TODO Include the early analysis we did here, that did not work as a result of limited scope. Could include some of the genetic work also. Will additionally need to put the relevant materials from the paper in the  -->


# Other Appendices {#other-appendix-heading}

## Software used to create this thesis

```{r, include = FALSE}
knitr::write_bib(c(.packages(), "bookdown", "knitr"), here::here("bibliography/packages.bib"))
```

<!-- TODO These citations are not rendering properly - I think because bookdown using this latex format only allows 1 .bib file. -->

This thesis was written in RMarkdown. Several R packages were used as part of this project.`r gen_rmd_citation("packages.bib")`
All projects in these thesis attempt to conform to minimal best practices for research computing. [@wilson2014; @wilson2017]


## Producing risk-of-bias visualisations with `robvis` {#appendix-robvis}

<!-- TODO Need to complete this sections -->

_TBC_

\newpage

## Copies of papers arising from this thesis {#published-papers}

The following pages contain copies of papers arising from work performed as part of this thesis.

<!-- TODO May need to reiterate contributions here -->

\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/cprd_medrxiv.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/medrxivr.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/robvis.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/DAS_comparison.pdf}
\includepdf[pages=-,pagecommand={\thispagestyle{empty}}]{published/prevsci.pdf}